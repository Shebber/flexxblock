<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flexblock Verify</title>
  <style>
    html, body {
      margin:0; padding:0; height:100%; overflow:hidden;
      background:#000; color:#fff; font-family:Arial, Helvetica, sans-serif;
    }
    header {
      position:fixed; top:0; left:0; right:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:20px 32px; background:rgba(0,0,0,0.4);
      backdrop-filter: blur(6px);
    }
    .wordmark img { height:65px; width:auto; display:block; }
    .tag { font-size:22px; color:#f0f0f0; letter-spacing:1px; }
    main.wrap {
      position:relative; display:flex; justify-content:center; align-items:center;
      height:100vh; text-align:left; z-index:5;
    }
    section.card {
      background:rgba(0,0,0,0.65); border:1px solid rgba(255,255,255,0.1);
      padding:40px; border-radius:12px; box-shadow:0 0 18px rgba(255,0,255,0.1);
      max-width:1000px; width:90%;
    }
    .grid { display:flex; flex-wrap:wrap; gap:40px; align-items:flex-start; }
    .art img { max-width:420px; width:100%; border-radius:10px; }
    .badge { color:#f0f; margin-bottom:8px; }
    .kv { display:flex; gap:12px; margin:6px 0; }
    .k { width:90px; opacity:0.7; }
    .v, .code { font-family:monospace; }
    .btn {
      display:inline-block; padding:8px 16px; background:#f0f; color:#fff;
      text-decoration:none; border-radius:4px; margin-right:8px;
    }
    .muted { opacity:0.6; font-size:14px; margin-top:12px; }
    .icon-watermark {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; justify-content:center; align-items:center;
      z-index:0; pointer-events:none;
    }
    footer {
      position:fixed; bottom:0; left:0; right:0; text-align:center;
      padding:8px; font-size:13px; opacity:0.4;
    }
    canvas#gl {
      position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1;
    }
  </style>
</head>
<body>
  <canvas id="gl"></canvas>

  <header>
    <span class="wordmark">
      <img src="https://www.rockshebbich.de/flexblock/flexblock_wordmark_col.svg"
           alt="Flexblock Logo">
    </span>
    <span class="tag">verify</span>
  </header>

  <div class="icon-watermark">
    <img src="https://www.rockshebbich.de/flexblock/flexblock_icon_sw.svg"
         alt="" style="width:70%;opacity:0.06;">
  </div>

  <main class="wrap">
    <section class="card">
      <div class="grid">
        <div class="art">
          <img id="artImage" alt="Artwork" src="" />
        </div>
        <div class="meta">
          <div class="badge">● verified • on-chain linked</div>
          <h1 id="title">Lade Daten…</h1>

          <div class="kv"><div class="k">Chain</div><div id="chain" class="v"></div></div>
          <div class="kv"><div class="k">Contract</div><div id="contract" class="v"><span class="code"></span></div></div>
          <div class="kv"><div class="k">Token</div><div id="token" class="v"></div></div>
          <div class="kv"><div class="k">Owner</div><div id="owner" class="v"><span class="code"></span></div></div>

          <div class="actions">
            <a id="mkt" class="btn" href="#" target="_blank" rel="noopener">Marktplatz</a>
            <a id="ipfs" class="btn" href="#" target="_blank" rel="noopener">IPFS</a>
          </div>
          <div class="muted" id="notes"></div>
        </div>
      </div>
    </section>
  </main>

  <footer>© 2025 Flexblock</footer>

  <!-- Hauptlogik -->
  <script>
  (async function(){
    const app = document.querySelector('main.wrap');
    if(!app){ console.error('Kein main.wrap gefunden'); return; }

    function byId(id){return document.getElementById(id);}
    function safe(x){return String(x ?? '');}

    // Pfad-Analyse (/verify/001)
    function currentId(){
      const parts = location.pathname.replace(/^\/+|\/+$/g,'').split('/');
      const idx = parts.indexOf('verify');
      return (idx>=0 && parts[idx+1]) ? parts[idx+1] : '001';
    }

    // JSON laden
    async function loadData(){
      const res = await fetch('data/artworks.json', {cache:'no-store'});
      if(!res.ok) throw new Error('Kann data/artworks.json nicht laden');
      return res.json();
    }

    // Render
    async function render(){
      let data;
      try{ data = await loadData(); }
      catch(e){
        app.innerHTML = '<div style="padding:24px;color:#fff">Fehler: '+e.message+'</div>';
        return;
      }
      const id = currentId();
      const art = data[id];
      if(!art){
        app.innerHTML = '<div style="padding:24px;color:#fff"><h2>Artwork nicht gefunden</h2><div class="muted">ID: '+id+'</div></div>';
        return;
      }
      const img = byId('artImage');
      if(img){ img.src = art.image; img.alt = art.title; }
      byId('title').textContent = safe(art.title);
      byId('chain').textContent = safe(art.chain);
      const contractEl = byId('contract')?.querySelector('.code');
      if(contractEl) contractEl.textContent = safe(art.contract);
      byId('token').textContent = '#'+safe(art.tokenId);
      const ownerEl = byId('owner')?.querySelector('.code');
      if(ownerEl) ownerEl.textContent = safe(art.owner);
      byId('mkt').href = safe(art.opensea||'#');
      byId('ipfs').href = safe(art.ipfs||'#');
      byId('notes').textContent = safe(art.notes||'');
    }

    // Starte
    await render();
  })();
  </script>

  <!-- WebGL Noise -->
  <script>
  (function(){
    const canvas=document.getElementById('gl');
    const gl=canvas.getContext('webgl',{alpha:true,antialias:false});
    if(!gl)return;
    const vertSrc=`attribute vec2 a;void main(){gl_Position=vec4(a,0.0,1.0);}`;
    const fragSrc=`precision highp float;uniform vec2 r;uniform float t;
      float hash(vec2 p){return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453123);}
      float noise(vec2 p){vec2 i=floor(p);vec2 f=fract(p);
        float a=hash(i),b=hash(i+vec2(1.,0.)),c=hash(i+vec2(0.,1.)),d=hash(i+vec2(1.,1.));
        vec2 u=f*f*(3.-2.*f);return mix(a,b,u.x)+(c-a)*u.y*(1.-u.x)+(d-b)*u.x*u.y;}
      void main(){vec2 uv=gl_FragCoord.xy/r.xy;vec2 p=vec2(uv.x*1.2,uv.y*1.2);
        float n1=noise(p*3.+vec2(0.,t*.3));float n2=noise(p*8.+vec2(t*.15,-t*.22));
        float scan=sin(uv.y*1200.+t*18.)*.04;float drift=noise(vec2(uv.y*40.,t*.8))*.1;
        float bar=smoothstep(0.,.02,abs(fract(uv.y*8.+t*.4)-.5))*.4;
        float glitch=step(.97,fract(sin(t*53.)*43758.5453));
        float g=n1*.55+n2*.3+scan+drift+bar*glitch;
        vec3 base=vec3(.02,0.,.04);vec3 mag=vec3(1.,0.,1.);
        vec3 c=base+mag*(.26+g*.36);
        vec2 d=uv-.5;float vig=1.-dot(d,d)*1.2;c*=clamp(vig,.15,1.);
        gl_FragColor=vec4(c,1.);}
    `;
    function compile(t,s){const sh=gl.createShader(t);gl.shaderSource(sh,s);gl.compileShader(sh);
      if(!gl.getShaderParameter(sh,gl.COMPILE_STATUS)){console.warn(gl.getShaderInfoLog(sh));}
      return sh;}
    const vs=compile(gl.VERTEX_SHADER,vertSrc);
    const fs=compile(gl.FRAGMENT_SHADER,fragSrc);
    const prog=gl.createProgram();
    gl.attachShader(prog,vs);gl.attachShader(prog,fs);gl.linkProgram(prog);
    gl.useProgram(prog);
    const a=gl.getAttribLocation(prog,'a');
    const ur=gl.getUniformLocation(prog,'r');
    const ut=gl.getUniformLocation(prog,'t');
    const buf=gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER,buf);
    gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW);
    gl.enableVertexAttribArray(a);gl.vertexAttribPointer(a,2,gl.FLOAT,false,0,0);
    function resize(){const w=innerWidth*(devicePixelRatio||1),h=innerHeight*(devicePixelRatio||1);
      if(canvas.width!==w||canvas.height!==h){canvas.width=w;canvas.height=h;}
      gl.viewport(0,0,canvas.width,canvas.height);}
    addEventListener('resize',resize);resize();
    let start=performance.now();
    (function loop(){
      const t=(performance.now()-start)/1000;
      gl.uniform2f(ur,canvas.width,canvas.height);
      gl.uniform1f(ut,t);
      gl.drawArrays(gl.TRIANGLES,0,6);
      requestAnimationFrame(loop);
    })();
  })();
  </script>
</body>
</html>
